<!DOCTYPE html>
<html>
  <head id="head">
    <meta charset="UTF-8">
    <meta name="description" content="@renerocksai - personal blog">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@renerocksai">
    <meta name="twitter:author" content="@renerocksai">
    <meta name="twitter:description" content="@renerocksai - personal blog">
    <meta name="twitter:title" content="Syncing your Obsidian vault to Android via an encrypted GitHub repository | @renerocksai">
    <meta name="twitter:image" content="https://renerocks.ai/reneglasses.png">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Syncing your Obsidian vault to Android via an encrypted GitHub repository | @renerocksai">
    <meta property="og:image" content="https://renerocks.ai/reneglasses.png">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title id="title">
      Syncing your Obsidian vault to Android via an encrypted GitHub repository
      - @renerocksai
    </title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/main.css">
    <link rel="stylesheet" type="text/css" href="/highlight.css">
    
  <link type="text/css" rel="stylesheet" href="/term-highlight.css">
  <style>
    #docs {
        h1, h2, h3, h4 {
            text-align: left;
            a {
                color: black;
                text-decoration: none;
            }
        }
        @media (prefers-color-scheme:dark) {
          h1, h2, h3, h4 {
            a {
              color: white;
            }
          }
        }

        h2 {
            font-size: 1.5rem;
            border-bottom: 1px dashed #aaa;
            margin-top: 2em;
            a:hover::after {
                content: ' #';
            }
        }

        h3 {
            font-size: 1.5rem;
            a:hover::after {
                content: ' ##';
            }
        }

        h4 {
            font-size: 1rem;
            a:hover::after {
                content: ' ###';
            }
        }

    }

    table {
        font-size: 0.9em;
    }
    table th {
        font-size: 1em;
    }
    table td {
        white-space: nowrap;
    }
  </style>

  </head>
  <body>
    <div id="content">
      
  <div style="display:flex; flex-direction:column; align-items:center;">
    <h1 id="header" class="noupper" style="color: #606060"><a class="reset-a" href="/">@renerocksai</a></h1>
    <div class="menu-small" style="display:flex; justify-content:center; font-size:small;">
      <a href="/">Home</a>
      •
      <a href="/blog/">Blog</a>
      •
      <a href="/projects/">Projects</a>
      •
      <a href="/about/">About</a>
      •
      <a href="https://github.com/renerocksai" target="_blank">
        GitHub
      </a>
    </div>
  </div>
  <h1>Syncing your Obsidian vault to Android via an encrypted GitHub repository</h1>
  <p class="post-byline">
    <span>January 18, 2021</span>
    •
    <span>15</span>
    min read • by
    <b>renerocksai</b>
    <span></span>
  </p>
  <div id="post-description"></div>
  <div>
    <div class="toc block info">
      <h1>&nbsp;Table of Contents</h1>
      <div><ul>
<li>
<ul><li>
Front matter</li><li>Motivation<ul><li>
Why not use BoxCryptor / Cryptomator and DropBox?<ul><li>
The broken Boxcryptor</li><li>Cryptomator</li><li>Why I don't like cloud encryption software for my Zettelkasten</li></ul></li><li>Why I prefer git and GitHub</li></ul></li><li>Git and git-crypt<ul><li>
(Re-) Initialize your Repo</li><li>Set up gitignore and .gitattributes</li><li>Add your files</li><li>TEST YOUR .gitattributes</li><li>Commit and push<ul><li>
Set up remote repo for testing your config</li><li>Cleaning up local test repos</li></ul></li></ul></li><li>Push to GitHub<ul><li>
Checking it out on a different machine</li></ul></li><li>Obsidian</li><li>Android<ul><li>
Installing termux</li><li>GitHub</li><li>git-crypt</li><li>Shortcuts for committing, pushing, and pulling</li><li>Adding shortcuts to the homescreen</li></ul></li><li>Research</li></ul></ul></div>
    </div>
  </div>
  <div id="docs">
    <div id="post-body"><p>Here I show you how I use an encrypted git repository on GitHub to sync my Zettelkasten to all my devices, including my Android smartphone.</p><p>In case you're wondering: My digital Zettelkasten is a folder in my filesystem, containing plain text files with Markdown formatting (and images) that I manage with <a href="https://obsidian.md" target="_blank">Obsidian</a> and sometimes with <a href="/projects/sublimeless_zk/">Sublimeless_ZK</a>. This future-proof format lends itself perfectly to being version controlled and distributed with <a href="https://git-scm.org" target="_blank">git</a>.</p><div class="block warning"><h1>Update</h1><p><strong>If you implement this, please make sure you also follow along my post about <a href="/blog/merge-conflicts-encrypted-zettelkasten/">merges and conflicts</a>!</strong></p></div><h2>Front matter</h2><p>You will get the most out of this article when you know git and the command line does not put you off. Setting up my workflow requires both. While I will walk you through all steps necessary to get to an encrypted, GitHub-hosted Zettelkasten, it can appear intimidating if you're completely unfamiliar with the command line.</p><p>I primarily work on Linux (or ChromeOS + Linux Shell), but all software involved is available for Windows and macOS, too.</p><h2>Motivation</h2><p>I usually use 5 different machines on a regular basis:</p><ul><li>my Chromebook is my private laptop</li><li>my Linux desktop at home with the big screen</li><li>my work laptop under Linux</li><li>occasionally my same work laptop, booted into Windows</li><li>my mobile phone running Android</li></ul><p>I want to be able to work on my notes on all machines.</p><p>The solution I came up with, involves the following software:</p><ul><li>git</li><li><code>Obsidian Git</code> Plugin for Obsidian</li><li><a href="https://github.com/AGWA/git-crypt" target="_blank">git-crypt</a></li><li><a href="https://termux.com/" target="_blank">termux</a> for Android</li><li><a href="https://wiki.termux.com/wiki/Termux:Widget" target="_blank">termux:widget</a> for Android</li></ul><h3>Why not use BoxCryptor / Cryptomator and DropBox?</h3><p>I had used DropBox sync in the past, with <a href="/projects/sublimeless_zk/">Sublimeless_ZK</a>, and that lead to all sorts of sync conflicts on the DropBox side of things, especially after having been offline for a while - and in general, the sync was rather slow and also intermixed with everything else in my DropBox that wanted syncing. Syncing my  Zettelkasten on Windows was never instant, as DropBox had to catch up with too much. Also, that time I didn't use any encryption.</p><h4>The broken Boxcryptor</h4><p>When searching for cloud encryption software, <a href="https://boxcryptor.com" target="_blank">Boxcryptor</a> is one of the first search results. From what I read, its Linux support seems to be second-class, only available via its "portable" version that seems to only allow access to files through its GUI, making it inaccessible for other software.</p><p>Google also returns that in the past, their "classic" version had supported Linux properly, something they seem to have given up on. These days, they seem to focus more on MS Teams than Linux.</p><p>What I also noticed is that Boxcryptor's download page is broken; it returns:</p><pre><code class="json">{<span class="string special key">&quot;error&quot;</span>:{},<span class="string special key">&quot;message&quot;</span>:<span class="string">&quot;Cannot read property &apos;structuredData&apos; of undefined&quot;</span>}
</code></pre>
<p>The overall picture I get, is:</p><ul><li>paid software</li><li>clear focus on Windows and Mac</li><li>subpar Linux support<ul><li>decision to not longer  support Linux as a first class citizen</li></ul></li><li>not realizing their download page is broken</li></ul><p>So Boxcryptor disqualified itself.</p><h4>Cryptomator</h4><p>I instantly liked <a href="https://cryptomator.org" target="_blank">Cryptomator</a>:</p><ul><li>it is free</li><li>it is open source</li><li>it supports Linux, Windows, Mac, Android, iOS</li><li>independent security audits exist</li></ul><p>So if I ever wanted to use cloud encryption software, it would be Cryptomator.</p><h4>Why I don't like cloud encryption software for my Zettelkasten</h4><p>Cloud encryption software like Cryptomator provides you with a virtual drive or virtual folder that acts as the interface to transparently encrypt and decrypt your files residing in another folder, one that is synced with the cloud.</p><p>The cloud-sync is left to the cloud provider. So to use Dropbox, you have to install their software that creates yet another virtual folder that gets synced to the cloud.</p><p>I don't like the idea of nesting virtual folders, and: I don't like to need to have encryption software and cloud-sync software running in the background. Especially on my chromebook, where I start the virtual Linux machine on-demand by opening the terminal, I want this to be as lightweight as possible. Just for running a terminal, I don't want to start unnecessary background software.</p><p>Instant synchronization, as handy as it might look, can be dangerous: If you delete a file (or large portions of it) by accident, this gets synced with the cloud instantly - your errors get propagated to all other devices instantly as well. By the time you realize you made a mistake, it might be too late. I don't like that. To protect yourself against such errors, you have to use some sort of backup or version control solution on top of the sync that sits on top of the transparent encryption.</p><p>Three layers of magic software is where too many things can go wrong. While I wouldn't mind syncing my Dropbox and using Cryptomator in general, I don't want to set them up just - and especially - for my Zettelkasten.</p><p>For all my version control needs I use git anyway - so if I can encrypt my git repository transparently, that's actually all I need.</p><h3>Why I prefer git and GitHub</h3><p>I quite like the synchronization workflow I get through git:</p><ul><li>I work on my local copy</li><li>I can refresh the local copy to the state of the cloud repository (<code>git pull</code>)</li><li>I can make changes locally</li><li>I stage the changes that I want to keep and commit them locally (<code>git add</code> and <code>git commit</code>)</li><li>When I'm happy with it, I push the changes to the cloud repository (<code>git push</code>)</li></ul><p>With an Obsidian plugin, committing and pushing are just one hotkey press away, as is pulling. If I feel like it, however, I can use git's command line tools or any other git software for syncing.</p><p>Syncing on demand is very useful. It protects me against accidently propagating mistakes to all synced devices. It gives me a chance to review my changes. And since git is built for distributed version control, detecting and resolving conflicts is something very natural to it.</p><p>Reverting back to previous versions, etc, is also possible with git. Since I use git extensively in my daily work, I really like the idea of using it to take care of my Zettelkasten, just as I trust it with all my source code.</p><p>Before deciding to taking my Zettelkasten (back to) the cloud, I had used git to sync between my devices:</p><ul><li>Chromebook</li><li>Linux desktop</li><li>Work laptop</li><li>Android phone</li></ul><p>However, I had used my Linux box for keeping the central repository that all working copies push to, with my local IP address. Obviously this only works in my home network, so syncing on the go is not possible.</p><p>Using GitHub (or GitLab) or any public, cloud-hosted git repository will provide me with an off-site backup in the cloud and will enable syncing at work and on the go.</p><p>So let's dive in and get our vault under git control.</p><h2>Git and git-crypt</h2><h3>(Re-) Initialize your Repo</h3><p>In the following examples, your Obsidian vault will be located in <code>~/zettelkasten</code>.</p><div class="block info"><h1>ATTENTION</h1><p><strong>!!! PLEASE MAKE A COPY OF YOUR VAULT FIRST !!!</strong></p></div><pre><code class="bash"><span class="constant">$ cp</span> <span class="constant">-pr</span> <span class="constant">zettelkasten</span> <span class="constant">zettelkasten.bak</span>
</code></pre>
<p>This, <code>zettelkasten.bak</code>, will be our backup if anything goes wrong later.</p><p>We initialize a git repository, initialize <code>git-crypt</code> and copy the secret key it generates to <code>~/git-crypt-key</code>:</p><pre><code class="bash"><span class="constant">$ cd</span> <span class="constant">zettelkasten</span>

<span class="comment"># delete existing git repo</span>
<span class="comment"># let&apos;s not expose cleartext history!</span>
<span class="constant">$ rm</span> <span class="constant">-fr</span> <span class="constant">.git/</span>

<span class="constant">$ git</span> <span class="constant">init</span>
<span class="constant">$ git-crypt</span> <span class="constant">init</span>

<span class="constant">$ git-crypt</span> <span class="constant">export-key</span> <span class="constant">../git-crypt-key</span>
</code></pre>
<h3>Set up gitignore and .gitattributes</h3><p>Here is my <code>.gitignore</code>, you may want to put the entire <code>.obsidian</code> directory into there, but I prefer it this way:</p><p>My <code>.gitignore</code>:</p><pre><code>.obsidian/workspace
.obsidian/cache
</code></pre><p>Alternatively, just copy back the ignore file from your backup if you had used git before:</p><pre><code class="bash"><span class="constant">$ cp</span> <span class="constant">../zettelkasten.bak/.gitignore</span> <span class="constant">.</span>
</code></pre>
<p><code>git-crypt</code> only encrypts files with certain git attributes. In my case, I specify:</p><ul><li>all <code>.md</code> markdown files in all subfolders</li><li>all files in all subfolders<ul><li>this wil exclude dotfiles like <code>.gitattributes</code></li></ul></li></ul><p>You need to store these attributes in a file called <code>.gitattributes</code>.</p><p>Here is my <code>.gitattributes</code>:</p><pre><code>*.md filter=git-crypt diff=git-crypt
*/** filter=git-crypt diff=git-crypt
</code></pre><p>Now, if you're using <code>oh-mz-zsh</code>, the following two commands will prevent it from slowing down your command line:</p><pre><code class="bash"><span class="constant">$ git</span> <span class="constant">config</span> <span class="constant">--add</span> <span class="constant">oh-my-zsh.hide-status</span> <span class="constant">1</span>
<span class="constant">$ git</span> <span class="constant">config</span> <span class="constant">--add</span> <span class="constant">oh-my-zsh.hide-dirty</span> <span class="constant">1</span>
</code></pre>
<h3>Add your files</h3><pre><code class="bash"><span class="constant">$ git</span> <span class="constant">add</span> <span class="constant">.</span>
</code></pre>
<h3>TEST YOUR .gitattributes</h3><pre><code class="bash"><span class="constant">$ git</span> <span class="constant">ls-files</span> <span class="constant">-z</span> <span class="operator">|</span><span class="constant">xargs</span> <span class="constant">-0</span> <span class="constant">git</span> <span class="constant">check-attr</span> <span class="constant">filter</span> <span class="operator">|</span><span class="constant">grep</span> <span class="constant">unspecified</span>
</code></pre>
<p>You should only see harmless files like <code>.gitattributes</code> be reported as unspecified. If any file pops up here that you want to be encrypted, you need to change your <code>.gitattributes</code>.</p><p>If unsure, use mine:</p><pre><code>*.md filter=git-crypt diff=git-crypt
*/** filter=git-crypt diff=git-crypt
</code></pre><h3>Commit and push</h3><p>First, we'll commit all files we have added before:</p><pre><code class="bash"><span class="constant">$ git</span> <span class="constant">commit</span> <span class="constant">-m</span> <span class="constant">&apos;.&apos;</span>
</code></pre>
<h4>Set up remote repo for testing your config</h4><p>In order to test the encryption when pushing, we'll set up a bare git repository :</p><pre><code class="bash"><span class="constant">$ cd</span>
<span class="constant">$ mkdir</span> <span class="constant">bare</span>
<span class="constant">$ cd</span> <span class="constant">bare</span>
<span class="constant">$ git</span> <span class="constant">init</span> <span class="constant">--bare</span>
</code></pre>
<p>We'll temporarily add it as remote repo and push our zettelkasten there:</p><pre><code class="bash"><span class="constant">$ cd</span>
<span class="constant">$ cd</span> <span class="constant">zettelkasten</span>
<span class="constant">$ git</span> <span class="constant">remote</span> <span class="constant">add</span> <span class="constant">bare</span> <span class="constant">../bare</span>
<span class="constant">$ git</span> <span class="constant">push</span> <span class="constant">bare</span> <span class="constant">master</span>
</code></pre>
<p>Now we clone the bare repo to see whether we get back encrypted files:</p><pre><code class="bash"><span class="constant">$ cd</span>
<span class="constant">$ git</span> <span class="constant">clone</span> <span class="constant">bare</span> <span class="constant">testcrypt</span>
<span class="constant">$ cd</span> <span class="constant">testcrypt</span>
<span class="constant">$ cat</span> <span class="constant">some</span> <span class="constant">file</span>
</code></pre>
<p>The file should come back as scrambled. Let's try to unlock the repository:</p><pre><code class="bash"><span class="constant">$ git-crypt</span> <span class="constant">unlock</span> <span class="constant">../git-crypt-key</span>
<span class="constant">$ cat</span> <span class="constant">some</span> <span class="constant">file</span>
</code></pre>
<p>The file should be decrypted.</p><div class="block warning"><h1>Note</h1><p>From now on, you can add, commit, push from the <code>testcrypt</code> repository, and <code>git-crypt</code> will transparently encrypt and de-crypt your files.</p></div><h4>Cleaning up local test repos</h4><pre><code class="bash"><span class="constant">$ cd</span>
<span class="constant">$ rm</span> <span class="constant">-fr</span> <span class="constant">bare</span> <span class="constant">testcrypt</span>

<span class="constant">$ cd</span> <span class="constant">zettelkasten</span>
<span class="constant">$ git</span> <span class="constant">remote</span> <span class="constant">rm</span> <span class="constant">bare</span>
</code></pre>
<h2>Push to GitHub</h2><p>Create an empty, <strong>private</strong> repository on GitHub and follow the instructions about how to push an existing repository.</p><p>I assume, you have used GitHub before and have your credentials set up (e.g. for ssh use):</p><pre><code class="bash"><span class="constant">$ cd</span>
<span class="constant">$ cd</span> <span class="constant">zettelkasten</span>

<span class="constant">$ GH_USER=your</span> <span class="constant">github</span> <span class="constant">user</span> <span class="constant">name</span>
<span class="constant">$ GH_REPO=your</span> <span class="constant">repository</span> <span class="constant">name</span>

<span class="constant">$ git</span> <span class="constant">remote</span> <span class="constant">add</span> <span class="constant">origin</span> \
      <span class="constant">git@github.com:$GH_USER/$</span><span class="constant">GH_REPO.git</span>

<span class="constant">$ git</span> <span class="constant">branch</span> <span class="constant">-M</span> <span class="constant">main</span>   <span class="comment"># ...</span>
<span class="constant">$ git</span> <span class="constant">push</span> <span class="constant">-u</span> <span class="constant">origin</span> <span class="constant">main</span>
</code></pre>
<p>Great! Your encrypted zettelkasten is now on GitHub 😀!</p><h3>Checking it out on a different machine</h3><p>To work with your vault on a different machine</p><ul><li>install git-crypt</li><li>clone the repository</li><li>unlock the repository</li></ul><p>For that to work, copy the <code>git-crypt-key</code> to the new machine; I use <code>scp</code> for that:</p><pre><code class="bash"><span class="constant">$ cd</span>
<span class="constant">$ scp</span> <span class="constant">git-crypt-key</span> <span class="constant">other_machine:</span>
</code></pre>
<p>Now clone and unlock:</p><pre><code class="bash"><span class="constant">$ GH_USER=</span> <span class="constant">your</span> <span class="constant">github</span> <span class="constant">username</span>
<span class="constant">$ GH_REPO=</span> <span class="constant">your</span> <span class="constant">github</span> <span class="constant">repository</span> <span class="constant">name</span>

<span class="constant">$ git</span> <span class="constant">clone</span> <span class="constant">git@github.com:$GH_USER/$</span><span class="constant">GH_REPO.git</span>

<span class="constant">$ cd</span> <span class="constant">$GH_REPO</span>
<span class="constant">$ git-crypt</span> <span class="constant">unlock</span> <span class="constant">../git-crypt-key</span>
</code></pre>
<p>Don't forget, if you use <code>oh-my-zsh</code>, to do the following:</p><pre><code class="bash"><span class="constant">$ git</span> <span class="constant">config</span> <span class="constant">--add</span> <span class="constant">oh-my-zsh.hide-status</span> <span class="constant">1</span>
<span class="constant">$ git</span> <span class="constant">config</span> <span class="constant">--add</span> <span class="constant">oh-my-zsh.hide-dirty</span> <span class="constant">1</span>
</code></pre>
<div class="block warning"><h1>Note</h1><p>From now on, you can add, commit, push from the <code>testcrypt</code> repository, and <code>git-crypt</code> will transparently encrypt and de-crypt your files.</p></div><h2>Obsidian</h2><p>Install the plugin <code>Obsidian Git</code>. Configure the plugin: Make sure, <code>Disable push</code> is deactivated.</p><p>Do this on all your machines.</p><p>Now, every time you want to sync your changes, press <code>ctrl+p</code> and search for "Obsidian Git : commit ...".</p><p>The plugin will automatically pull all remote changes when you start Obsidian. If you leave it running for days, you might want to pull recent changes manually: <code>ctrl+p</code> and search for "Obsidian Git: Pull".</p><div class="block info"><h1>Update</h1><p><strong>If you implement this, please make sure you also follow along my post about <a href="/blog/merge-conflicts-encrypted-zettelkasten/">merges and conflicts</a>!</strong></p></div><h2>Android</h2><p>Now on to the most hacky part of them all: syncing your repository on Android!</p><p>Once you have your Zettelkasten on your mobile, you can access it, add and edit files with software like <a href="https://ia.net/writer" target="_blank">iA / Writer</a> or <a href="http://epsilonexpert.com" target="_blank">Epsilon Notes</a>.</p><p>We will install the fantastic <a href="https://termux.com/" target="_blank">termux</a> to get a Linux shell on Android. Then we will install <code>git</code> and <code>git-crypt</code>, and clone the repository like we would on Linux.</p><p>We'll add a handy commit and push and a pull shortcut that we can launch directly from the homescreen.</p><h3>Installing termux</h3><p>First, we install <code>termux</code>. The play store version works fine, eventhough they recommend <a href="https://f-droid.org/" target="_blank">F-Droid</a>. Later, we'll install an add-on that adds scripts for pulling and pushing to our homescreen. This add-on is free on F-Droid but costs ca EUR 2.00 on the play store. Since one shouldn't mix play store and F-Droid and I had termux installed already, I just kept continuing using the playstore version.</p><p>The following commands, typed within termux, will install git and git-crypt, and also give termux access to your phone's files.</p><p>within termux :</p><pre><code class="bash"><span class="constant">$ pkg</span> <span class="constant">install</span> <span class="constant">git</span> <span class="constant">git-crypt</span>

<span class="comment"># make storage available</span>
<span class="constant">$ termux-setup-storage</span>

<span class="comment"># this will give you the storage directory</span>
</code></pre>
<p>Now we'll prepare for GitHub access.</p><h3>GitHub</h3><p>First, we generate a new ssh key for Android.</p><p>In termux, we type:</p><pre><code class="bash"><span class="constant">$ ssh-keygen</span> <span class="constant">-t</span> <span class="constant">ed25519</span> <span class="constant">-C</span> <span class="constant">&quot;your_email@example.com&quot;</span>
</code></pre>
<p>When prompted for a passphrase, we just press enter.</p><p>Next, we add the ssh key to GitHub: <a href="https://docs.github.com/en/github/authenticating-to-github/adding-a-new-ssh-key-to-your-github-account" target="_blank">like described here</a>:</p><ul><li>we sign in to Github</li><li>we click our photo</li><li>we select settings</li><li>we click on "SSH and GPG keys"</li><li>we click on "New SSH key"</li><li>we go to termux and type <code>cat .ssh/id_ed25519.pub</code></li><li>we copy the key</li><li>we paste it into the "key" field of the browser</li><li>we click "Add SSH key"</li></ul><h3>git-crypt</h3><p>We need to copy the <code>git-crypt-key</code> file into termux. I zipped it, uploaded it to a safe space, and used Chrome on Android to download it. So my downloads folder contained <code>git-crypt-key.zip</code>. So in termux, I typed:</p><pre><code class="bash"><span class="constant">$ cd</span>
<span class="constant">$ unzip</span> <span class="constant">storage/downloads/git-crypt-key.zip</span>
<span class="constant">$ chmod</span> <span class="constant">600</span> <span class="constant">git-crypt-key</span>
</code></pre>
<p>Next, we clone the repository:</p><pre><code class="bash"><span class="constant">$ GH_USER=</span> <span class="constant">your</span> <span class="constant">github</span> <span class="constant">username</span>
<span class="constant">$ GH_REPO=</span> <span class="constant">your</span> <span class="constant">github</span> <span class="constant">repository,</span> <span class="constant">e.g.</span> <span class="constant">zettelkasten</span>
<span class="constant">$ git</span> <span class="constant">clone</span> <span class="constant">git@github.com:$GH_USER/$</span><span class="constant">GH_REPO.git</span>
</code></pre>
<p>Now we unlock it using <code>git-crypt</code>:</p><pre><code class="bash"><span class="constant">$ cd</span> <span class="constant">$GH_REPO</span>
<span class="constant">$ git-crypt</span> <span class="constant">unlock</span> <span class="constant">../git-crypt-key</span>
</code></pre>
<p>Once it's finished, we move it to the shared folder:</p><pre><code class="bash"><span class="constant">$ cd</span>
<span class="constant">$ mv</span> <span class="constant">$GH_REPO</span> <span class="constant">storage/shared/</span>
</code></pre>
<p>Great, now you can access your notes from any Android app!</p><h3>Shortcuts for committing, pushing, and pulling</h3><p>We'll create a few scripts:</p><p><strong><code>repo.conf</code>:</strong></p><pre><code class="bash"><span class="property">GH_REPO</span>=zettelkasten
</code></pre>
<p><strong><code>pull.sh</code>:</strong></p><pre><code class="bash"><span class="constant">source</span> <span class="constant">$HOME/repo.conf</span>
<span class="constant">cd</span> <span class="constant">$HOME/storage/shared/$GH_REPO</span>
<span class="constant">git</span> <span class="constant">pull</span>
<span class="constant">cd</span> <span class="constant">$HOME</span>
<span class="constant">bash</span> <span class="constant">-c</span> <span class="constant">&quot;read -t 3 -n 1&quot;</span>
</code></pre>
<p><strong><code>push.sh</code>:</strong></p><pre><code class="bash"><span class="constant">source</span> <span class="constant">$HOME/repo.conf</span>
<span class="constant">cd</span> <span class="constant">$HOME/storage/shared/$GH_REPO</span>
<span class="constant">git</span> <span class="constant">add</span> <span class="constant">.</span>
<span class="constant">git</span> <span class="constant">commit</span> <span class="constant">-m</span> <span class="constant">&quot;android on $(date)&quot;</span>
<span class="constant">git</span> <span class="constant">push</span>
<span class="constant">cd</span> <span class="constant">$HOME</span>
<span class="constant">bash</span> <span class="constant">-c</span> <span class="constant">&quot;read -t 3 -n 1&quot;</span>
</code></pre>
<p><strong><code>log.sh</code>:</strong></p><pre><code class="bash"><span class="constant">source</span> <span class="constant">$HOME/repo.conf</span>
<span class="constant">cd</span> <span class="constant">$HOME/storage/shared/$GH_REPO</span>
<span class="constant">git</span> <span class="constant">log</span>
<span class="constant">cd</span> <span class="constant">$HOME</span>
<span class="constant">bash</span> <span class="constant">-c</span> <span class="constant">&quot;read -t 5 -n 1&quot;</span>
</code></pre>
<p>You can prepare and download them, just like we did with <code>git-crypt-key</code> or edit them directly in termux.</p><p>Next, we'll make them executable:</p><pre><code class="bash"><span class="constant">$ cd</span>
<span class="constant">$ chmod</span> <span class="constant">+x</span> <span class="constant">pull.sh</span> <span class="constant">push.sh</span> <span class="constant">log.sh</span>
</code></pre>
<p>From now on, we can commit and push like this:</p><pre><code class="bash"><span class="operator">$</span> <span class="constant">./push.sh</span>
</code></pre>
<p>And we can pull remote changes like this:</p><pre><code class="bash"><span class="operator">$</span> <span class="constant">./pull.sh</span>
</code></pre>
<p>We can see what version we're on with:</p><pre><code class="bash"><span class="operator">$</span> <span class="constant">./log.sh</span>
</code></pre>
<p>However, it will be even cooler, when we can push and pull directly from the homescreen of our phone.</p><h3>Adding shortcuts to the homescreen</h3><p>First, we need to install <code>termux: widget</code> from the play store or F-Droid, just like we did with termux itself.</p><p>Next, we create the shortcuts in termux:</p><pre><code class="bash"><span class="constant">$ cd</span>
<span class="constant">$ mkdir</span> <span class="constant">.shortcuts</span>
<span class="constant">$ cd</span> <span class="constant">shortcuts</span>
<span class="constant">$ ln</span> <span class="constant">-s</span> <span class="constant">../push.sh</span>
<span class="constant">$ ln</span> <span class="constant">-s</span> <span class="constant">../pull.sh</span>
<span class="constant">$ ln</span> <span class="constant">-s</span> <span class="constant">../log.sh</span>
</code></pre>
<p>After that, <strong>after exitting termux</strong>, you can open your launcher's widget menu, select <code>Termux:Widget</code> and place it on your home screen.</p><div class="block warning"><h1>Note</h1><p>The shortcuts will only work when termux is not running. To exit, type <code>exit</code> and press <code>[enter]</code>!</p></div><p>There are two different variants:</p><ul><li>one shows a little text menu</li><li>the other one allows you to place an icon per script</li></ul><p><figure><img src="/homescreen.jpg" alt="">
<figcaption>homescreen</figcaption></figure></p><p>And here is my output of <code>log.sh</code> on Android:</p><p><figure><img src="/gitlog.jpg" alt="">
<figcaption>gitlog</figcaption></figure></p><p>Et voila! Now you have an encrypted GitHub repository for your Zettelkasten that you can use to sync all your devices!</p><div class="block warning"><h1>Update</h1><p><strong>If you implement this, please make sure you also follow along my post about <a href="/blog/merge-conflicts-encrypted-zettelkasten/">merges and conflicts</a>!</strong></p></div><hr><h2>Research</h2><p>Here are a few notes I took while researching different options:</p><hr><ul><li><a href="https://github.com/AGWA/git-crypt" target="_blank">git-crypt</a><ul><li>only encrypts single files, GPG based,  supports symmetric keys</li><li>gitattributes to define what files to encrypt / decrypt<ul><li>can be tricky if you want all files to be encrypted<ul><li>need to avoid .gitattributes etc</li></ul></li></ul></li><li>cannot re-encrypt once keys are revoked, etc</li><li>for entire repos, they recommend <a href="https://spwhitton.name/tech/code/git-remote-gcrypt/" target="_blank">git-remote-gcrypt</a></li></ul></li></ul><hr><ul><li><a href="https://spwhitton.name/tech/code/git-remote-gcrypt/" target="_blank">git-remote-gcrypt</a><ul><li><blockquote><p>Using an arbitrary <code>&lt;giturl&gt;</code> or an <code>sftp://</code> URI requires uploading the entire repository history with each push.</p></blockquote></li><li><blockquote><p>every git push effectively has --force. Be sure to pull before pushing.</p></blockquote></li><li><blockquote><p>git-remote-gcrypt can decide to repack the remote without warning, which means that your push can suddenly take significantly longer than you were expecting, as your whole history has to be reuploaded. This push might fail over a poor link.</p></blockquote></li></ul></li></ul><hr><ul><li><a href="https://git-secret.io/" target="_blank">git-secret</a><ul><li>needs to .gitignore your real files</li><li>creates .secret files - doubling the number of files</li><li>needs git-secret reveal</li><li>shitty workflow</li></ul></li></ul><hr><ul><li><a href="https://github.com/elasticdog/transcrypt" target="_blank">transcrypt</a><ul><li>looks OK</li><li>uses .gitattributes, too</li></ul></li></ul><hr><ul><li><a href="https://gist.github.com/polonskiy/7e5d308ca6412765927a96bd74601a5e" target="_blank">this gist</a> looks promising<ul><li>but what about: android<ul><li>possible solution: termux</li></ul></li></ul></li></ul><hr><ul><li><a href="https://termux.com/" target="_blank">termux</a></li><li><a href="https://opensource.com/article/19/2/secrets-management-tools-git" target="_blank">4 secrets management tools for Git encryption</a></li><li><a href="https://hackernoon.com/things-you-must-know-about-git-crypt-to-successfully-protect-your-secret-data-kyi3wi6" target="_blank">Things You Must Know About git-crypt To Successfully Protect Your Secret Data</a></li></ul></div>
  </div>
  <hr>
  <div id="prev-next">
    <span>
      <a href="/blog/y-how-cpu-works/">←
        <span>How a CPU works</span></a>
    </span>
    <span>&nbsp; • &nbsp;</span>
    <span>
      <a href="/blog/merge-conflicts-encrypted-zettelkasten/"><span>Handling merges and conflicts in an encrypted GitHub Zettelkasten </span>
        →</a>
    </span>
    <small>&nbsp; or &nbsp;</small>
    <small>
      <a href="/">Back to the Homepage</a>
    </small>
  </div>

    </div>
    <footer id="footer">
      
    </footer>
  </body>
</html>
