<!DOCTYPE html>
<html>
  <head id="head">
    <meta charset="UTF-8">
    <meta name="description" content="@renerocksai - personal website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@renerocksai">
    <meta name="twitter:author" content="@renerocksai">
    <meta name="twitter:description" content="@renerocksai - personal website">
    <meta name="twitter:title" content="Jujutsu (version control) - one week in | @renerocksai">
    <meta name="twitter:image" content="https://renerocks.ai/reneglasses.png">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Jujutsu (version control) - one week in | @renerocksai">
    <meta property="og:image" content="https://renerocks.ai/reneglasses.png">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title id="title">
      Jujutsu (version control) - one week in
      - @renerocksai
    </title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/main.css">
    <link rel="stylesheet" type="text/css" href="/highlight.css">
    
  <link type="text/css" rel="stylesheet" href="/term-highlight.css">
  <style>
    #docs {
        h1, h2, h3, h4 {
            text-align: left;
            a {
                color: black;
                text-decoration: none;
            }
        }
        @media (prefers-color-scheme:dark) {
          h1, h2, h3, h4 {
            a {
              color: white;
            }
          }
        }

        h2 {
            font-size: 1.5rem;
            border-bottom: 1px dashed #aaa;
            margin-top: 2em;
            a:hover::after {
                content: ' #';
            }
        }

        h3 {
            font-size: 1.5rem;
            a:hover::after {
                content: ' ##';
            }
        }

        h4 {
            font-size: 1rem;
            a:hover::after {
                content: ' ###';
            }
        }

    }

    table {
        font-size: 0.9em;
    }
    table th {
        font-size: 1em;
    }
    table td {
        white-space: nowrap;
    }
  </style>

  </head>
  <body>
    <nav>
      <div class="navleft noupper" style="z-index:10">
        <span>@</span><a href="https://renerocks.ai/">renerocksai</a>
      </div>
      <div class="spacer"></div>
      <button class="hamburger" aria-label="Toggle menu">
         &#9776;
        <!-- Unicode for hamburger icon (☰) -->
      </button>
      <div class="menu">
        <a href="/">Home</a>
        <a href="/blog/">Blog</a>
        <a href="/projects/">Projects</a>
        <a href="/about/">About</a>
        <a href="https://github.com/renerocksai" target="_blank">
          GitHub
        </a>
      </div>
      <div class="spacer"></div>
    </nav>
    <div id="content">
      
  <h1>Jujutsu (version control) - one week in</h1>
  <p class="post-byline">
    <span>November 29, 2024</span>
    •
    <span>7</span>
    min read • by
    <b>renerocksai</b>
    <span></span>
  </p>
  <div id="post-description"></div>
  <div>
    <div class="toc block info">
      <h1>&nbsp;Table of Contents</h1>
      <div><ul>
<li>Jujutsu<ul><li>
Resources</li><li>My Experience with JJ<ul><li>
Why I like it after working with it for about a week</li><li>What I had to change</li></ul></li><li>BASIC Main workflow</li><li>BASIC Lazyjj workflow</li><li>Advanced Workflows<ul><li>
Creating a branch, pulling in another branch</li></ul></li></ul></ul></div>
    </div>
  </div>
  <div id="docs">
    <div id="post-body"><p><img src="/jj.png" alt=""></p><h1>Jujutsu</h1><p>…</p><ul><li>can be used as a <em>frontend</em> for git</li><li>has a very smooth CLI UI and workflow</li><li>I can confirm it is a joy to use</li></ul><p>I <strong>highly recommend</strong> watching the first video from the list below.</p><h2>Resources</h2><ul><li><p>Official</p><ul><li><a href="https://github.com/martinvonz/jj" target="_blank">Jujutsu on GitHub</a></li><li><a href="https://martinvonz.github.io/jj/latest/" target="_blank">Jujutsu Documentation</a></li></ul></li><li><p>Recommended tools:</p><ul><li><a href="https://github.com/Cretezy/lazyjj" target="_blank">lazyjj</a> - a great CLI UI frontend for JJ</li></ul></li><li><p>Introductory materials:</p><ul><li><strong><a href="https://www.youtube.com/watch?v=2otjrTzRfVk" target="_blank">What if version control was AWESOME?</a></strong> <code>[VIDEO]</code> – <strong>highly recommended</strong></li><li><a href="https://v5.chriskrycho.com/essays/jj-init/" target="_blank">jj init</a> – great article, see also the video above</li><li><a href="https://www.youtube.com/watch?v=dwyMlLYIrPk" target="_blank">Jujutsu | Ep. 5 Bits and Booze</a> <code>[VIDEO]</code> – a nice intro and walkthrough by GitButler</li><li><a href="https://lwn.net/Articles/958468/" target="_blank">Jujutsu: a new, Git-compatible version control system</a> - a bit dated but still good, from LWN.net</li></ul></li></ul><h2>My Experience with JJ</h2><h3>Why I like it after working with it for about a week</h3><p>I haven’t touched git since using JJ in a few repos. JJ makes my daily “git” use really effortless, it never gets in the way. Pulling in work from other branches, quickly peeking into just-fetched PR branches via editor, splitting commits, anonymous temp branches, squashing and pushing - have become really effortless. That’s not to say that git is necessarily too cumbersome for these tasks. But in comparison, JJ <em>feels</em> more “right” and easy most of the time.</p><p>I expected to miss the time I spent in <code>vim-fugitive</code>, staging, committing, and pushing directly from inside Neovim—a workflow I was very accustomed to—but surprisingly, I didn’t. Now, I’ve gotten lazy and often use <code>lazyjj</code> for most tasks, except for editing multi-line commit messages, where I still prefer Neovim over <code>lazyjj</code>’s built-in editor.</p><p>One thing I hadn’t anticipated: since your working copy is always committed—essentially functioning as an ever-amending commit—you can freely switch to past commits or other Git branches. This includes actions like “checking out” newly fetched PRs, viewing their diffs, and so on, all without any issues. No conflicts, no need to stash away changes temporarily!</p><p><strong>I can keep using git!</strong> I always work in <em>colocated</em> JJ repositories. That means, if I feel like it, I can switch to git / vim-fugitive for a while, and return to my old workflow. The next time I run <code>jj</code>, it will sync the changes. That really works like a charm.</p><h3>What I had to change</h3><p>TEMPORARY FILES! In some repositories, I collected quite an amount of temp files, artifacts like generated output files when quickly testing something, which I just kept ignoring when staging. Since JJ always snapshots the working copy, I had to <code>.gitignore</code> those.</p><p>Shoutout to Tom Lord, original author of <a href="https://www.gnu.org/software/gnu-arch/" target="_blank">Tom Lord’s then GNU arch</a>, which I had switched to after <code>CVS</code> - and probably <em>the</em> VCS that had the most influence on me, before eventually migrating to mercurial, and a long time later, eventually to git. To this day I still miss <em>some</em> of TLA’s features.</p><p>Anyway, I digress. Tom introduced me to prefixing filenames of “temporary” files with a comma: <code>,forgetme.txt</code>. I now returned to this practice, and put <code>,*</code> in my <code>.gitignore</code>. Yes, <code>jj</code> respects gitignore files!</p><h2>BASIC Main workflow</h2><pre><code class="bash"><span class="comment"># we start with git (and show how it&apos;s done BETTER with jj a few lines below)</span>
<span class="constant">git</span> <span class="constant">clone</span> <span class="constant">git@github.com...</span>

<span class="comment"># init jj alongside git - you do that only in existing git repos</span>
<span class="constant">jj</span> <span class="constant">git</span> <span class="constant">init</span> <span class="constant">--colocate</span>

<span class="comment"># start tracking your branches</span>
<span class="comment">#    jj can do that automatically, see jj git clone below</span>
<span class="constant">jj</span> <span class="constant">bookmark</span> <span class="constant">track</span> <span class="constant">master@origin</span>
<span class="constant">jj</span> <span class="constant">bookmark</span> <span class="constant">track</span> <span class="constant">whatever_branch@origin</span>



<span class="comment"># instead of all of the above, we can let jj do the git work, incl. tracking</span>
<span class="constant">jj</span> <span class="constant">git</span> <span class="constant">clone</span> <span class="constant">--colocate</span> <span class="constant">git@github.com...</span>



<span class="comment"># work:</span>
<span class="comment"># you `jj new`, `jj describe` for each change</span>
<span class="comment"># everytime you run jj after a save, the current change is updated</span>
<span class="comment"># you can `jj describe` at any time!</span>
<span class="constant">jj</span> <span class="constant">new</span>      <span class="comment"># new change: introduces a new commit to work on</span>

<span class="comment"># keep editing files ...</span>
<span class="constant">jj</span> <span class="constant">st</span>       <span class="comment"># show status of changed files etc</span>
<span class="constant">jj</span> <span class="constant">diff</span>     <span class="comment"># show diff</span>

<span class="constant">jj</span>          <span class="comment"># show log</span>
<span class="constant">jj</span> <span class="constant">log</span>      <span class="comment"># same</span>


<span class="constant">jj</span> <span class="constant">describe</span> <span class="comment"># change commit message at any time.</span>

<span class="comment"># change a commit message from a past change, identified by shortcut xx</span>
<span class="comment"># you see the shortcuts in jj log</span>
<span class="comment"># this works even with commits that have been pushed already!</span>
<span class="constant">jj</span> <span class="constant">desc</span> <span class="constant">-r</span> <span class="constant">xx</span>

<span class="comment"># pushing : catch up bookmark of git branch name to the (second-) most-recent change</span>
<span class="comment">#   - jj does not move the (git branch name) bookmark along with every change</span>
<span class="comment">#   - so you need to tell it to update the bookmark to the latest commit</span>
<span class="comment">#   - but if you `jj new`ed, you&apos;re on an empty commit.</span>
<span class="comment">#     so you want to update to the second-latest commit in that usual case.</span>
<span class="comment">#   @   denotes the current change</span>
<span class="comment">#   @-  denotes the change before the current change</span>
<span class="constant">jj</span> <span class="constant">bookmark</span> <span class="constant">set</span> <span class="constant">master</span> <span class="constant">-r</span> <span class="constant">@-</span>             <span class="comment"># provided we jj new&apos;ed before</span>
<span class="constant">jj</span> <span class="constant">bookmark</span> <span class="constant">set</span> <span class="constant">master</span> <span class="constant">-r</span> <span class="constant">@</span>              <span class="comment"># provided we did not jj new yet</span>
<span class="constant">jj</span> <span class="constant">bookmark</span> <span class="constant">set</span> <span class="constant">whatever_branch</span> <span class="constant">-r</span> <span class="constant">@-</span>    <span class="comment"># just a non-master example</span>

<span class="constant">jj</span> <span class="constant">git</span> <span class="constant">push</span> <span class="comment"># push the current commit&apos;s bookmark if there is one</span>

<span class="constant">jj</span> <span class="constant">undo</span> <span class="comment"># if you think you messed up</span>
</code></pre>
<h2>BASIC Lazyjj workflow</h2><p>It’s even easier. j/k to look at commits, d to run describe, n to create a new change, b to open the bookmark menu where you j/k to the bookmark you want to assign to the selected (second-latest/latest) change, p to push.</p><h2>Advanced Workflows</h2><p>You can get really advanced, without jj feeling complicated.</p><p>For example, when applying above commands like new, describe, etc to a change from the past. You can introduce changes/commits in-between earlier commits, branch off by inserting a series of changes “in the past”, merge, split changes into multiple ones, … etc. etc.</p><p>The displayed shortcuts for change and commit IDs are really helpful for the CLI.</p><p>And I haven’t even mentioned the <code>jj operation log</code> !!!</p><p>The YT videos go into some more advanced uses of jj.</p><p>See below for an example from me.</p><h3>Creating a branch, pulling in another branch</h3><p>So I decide to work on a branch & GitHub PR. In jj, we use bookmarks to work with named git branches.</p><pre><code class="bash"><span class="comment"># I am on the master branch</span>
<span class="constant">jj</span> <span class="constant">new</span> <span class="comment"># to make a new change</span>
<span class="constant">jj</span> <span class="constant">bookmark</span> <span class="constant">create</span> <span class="constant">rene/feature_A</span>

<span class="comment"># yayyy!</span>
</code></pre>
<p>I work on my branch:</p><pre><code class="bash"><span class="constant">jj</span> <span class="constant">new</span>

<span class="comment"># edit files</span>

<span class="constant">jj</span> <span class="constant">describe</span> <span class="constant">-m</span> <span class="constant">&quot;blah&quot;</span>

<span class="comment"># repeat (editing and describing)...</span>
<span class="comment"># ...</span>

<span class="comment"># time to push</span>
<span class="constant">jj</span> <span class="constant">new</span>
<span class="constant">jj</span> <span class="constant">bookmark</span> <span class="constant">set</span> <span class="constant">rene/feature_A</span> <span class="constant">@-</span>
<span class="constant">jj</span> <span class="constant">git</span> <span class="constant">push</span>
<span class="comment"># or lazyjj this effortlessly and press p to push</span>
</code></pre>
<p>At some stage, a colleague of mine informs us that they made changes in a PR that we want in our branch/PR as well. So first, we fetch to get your colleague’s branch:</p><pre><code class="bash"><span class="constant">jj</span> <span class="constant">git</span> <span class="constant">fetch</span>
</code></pre>
<p>We then jj log to see the branch or, if we just want the change ID of the PR, we can check out the list of bookmarks:</p><pre><code class="bash"><span class="constant">jj</span> <span class="constant">bookmark</span> <span class="constant">list</span>

<span class="constant">friend/feature_B:</span> <span class="constant">ypvwxzwo</span> <span class="constant">db1c5ccb</span> <span class="constant">fix</span> <span class="constant">comment</span>
<span class="constant">master:</span> <span class="constant">xxqnkzkt</span> <span class="constant">6443fef5</span> <span class="constant">use</span> <span class="constant">correct</span> <span class="constant">path</span> (<span class="comment">#35)</span>
<span class="constant">rene/feature_A:</span> <span class="constant">mwlxnqmm</span> <span class="constant">efb96bea</span> <span class="constant">great</span> <span class="constant">progress</span>
</code></pre>
<p>In <code>jj log</code> we also see that master has moved on with more commits, but that doesn’t bother us because we want to keep working on our branch.</p><p>So, we see the following. Our branch is at change <strong>mw</strong>lxnqmm and our friend’s branch is at change <strong>yp</strong>vwxzwo. Perfect!</p><p><em>Optional: Because our working copy is clean, we can check out the new branch and have a look at it in our editor / IDE: <code>jj edit yp</code>. When done checking it out, we just return to where we left off: <code>jj edit mw</code>. One tip though: in order to not change past commits by accident, do a <code>jj new</code> right after switching to <code>yp</code>. You can abandon that change later if you like: <code>jj abandon</code>. When done, we switch back to where we were: <code>jj edit mw</code>.</em></p><p>To bring in the changes from our friend’s PR, we just create a new change that’s based on <strong>two parents</strong>: our last commit and the last commit from our friend’s PR:</p><pre><code class="bash"><span class="constant">jj</span> <span class="constant">new</span> <span class="constant">mw</span> <span class="constant">yp</span>
</code></pre>
<p>DONE!</p><p>We now describe and push to GitHub:</p><pre><code class="bash"><span class="constant">jj</span> <span class="constant">describe</span> <span class="constant">-m</span> <span class="constant">&quot;pulled in PR #xx&quot;</span>
<span class="constant">jj</span> <span class="constant">bookmark</span> <span class="constant">set</span> <span class="constant">rene/feature_A</span> <span class="constant">@</span>
<span class="constant">jj</span> <span class="constant">git</span> <span class="constant">push</span>

<span class="constant">jj</span> <span class="constant">new</span>
</code></pre>
<p>And we keep on working …</p></div>
  </div>
  <hr>
  <div id="prev-next">
    <span>
      <a href="/blog/merge-conflicts-encrypted-zettelkasten/">←
        <span>Handling merges and conflicts in an encrypted GitHub Zettelkasten </span></a>
    </span>
    <span>&nbsp; • &nbsp;</span>
    <span>
      <a href="/blog/jj-clean-history/"><span>Recovering Clean History in Jujutsu (jj)</span>
        →</a>
    </span>
    <small>&nbsp; or &nbsp;</small>
    <small>
      <a href="/">Back to the Homepage</a>
    </small>
  </div>

    </div>
    <footer id="footer">
      
    </footer>
    <script>
      document.querySelector('.hamburger').addEventListener('click', function() {
        document.querySelector('.menu').classList.toggle('active');
        console.log("CLICK");
    });
    </script>
  </body>
</html>
